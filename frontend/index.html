<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>DECIMA app</title>

  <!-- Styles -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/atom-one-dark.min.css">
</head>
<body>
  <div class="main-container">

    <!-- Header -->
    <header class="app-header">
      <img src="{{ url_for('static', filename='img/decima_logo.png') }}" alt="DECIMA Logo" class="decima-logo">
      <p class="subtitle capsule">Data Extraction & Contextual Inference for MCNP Analysis</p>
    </header>

    <!-- KG/Neo4j warning banner -->
    <div id="kg-warning" class="warning-banner" style="display:none;">
      <i class="fas fa-triangle-exclamation"></i>
      EMMA KG is not loaded. The answer was produced without KG context.
    </div>

    <!-- Upload section -->
    <section class="upload-section">
      <button id="open-file-btn" class="upload-btn">
        <i class="fas fa-file-upload"></i> Load PTRAC File
      </button>
      <input type="file" id="ptrac-file" accept=".ptrac, .ip, .p" style="display: none;">
      <div id="file-info" class="file-info"></div>
    </section>

    <!-- Instructional message -->
    <section class="instruction-message">
      <h2 class="instruction-title">
        Ask a precise and concise question related to the specific event data in your PTRAC file
      </h2>

      <div class="examples-block center-column">
        <p class="examples-title">Examples:</p>
        <ul>
          <li>Print x y z positions and energies of all the particles entering the Water moderator (cell 502)</li>
          <li>How many secondary photons are emitted and what is their process of termination?</li>
          <li>Plot the z-axis direction cosine (W) distribution of emitted source particles and display their average energy</li>
          <li>For the first 10 histories, display the full path of neutrons from source to termination, including energy and position at each collision</li>
          <li>Plot the collision energy spectrum of neutrons interacting with U-235 through elastic scattering reaction</li>
        </ul>
      </div>
    </section>

    <!-- Chat section -->
    <div class="chat-wrapper">
      <!-- Otacon on the left side -->
      <div class="otacon-side">
        <img src="{{ url_for('static', filename='img/classy_otacon.png') }}" alt="Otacon" class="otacon-img">
        <div class="otacon-caption">LLM Otacon ready to assist you with PTRAC analysis</div>
      </div>

      <!-- Chat box -->
      <section class="chat-section center-column">
        <div id="chat-messages" class="chat-messages"></div>
        <div class="chat-input-block">
          <div id="reasoning-loader" class="loader-message" style="display: none;">
            <i class="fas fa-spinner fa-spin"></i> Reasoning...
          </div>
          <div class="chat-input">
            <textarea id="query-input" placeholder="Ask your question here..."></textarea>
            <button id="send-btn"><i class="fas fa-paper-plane"></i></button>
          </div>
          <div class="model-select">
            <label for="model-choice">Model:</label>
            <select id="model-choice">
              <option value="gpt-4o-mini">gpt-4o-mini</option>
              <option value="gpt-4o">gpt-4o</option>
              <!-- <option value="asi1-mini">asi1-mini</option> -->
            </select>
          </div>
          <div class="context-toggle">
            <input type="checkbox" id="context-toggle" checked>
            <label for="context-toggle">Add context</label>
          </div>
        </div>
      </section>
    </div>



    <!-- Result output -->
    <div class="chat-wrapper">
      <section id="result-section" class="result-section center-column" style="display: none;">
        <h3>Execution Result</h3>
        <pre id="execution-stdout"></pre>
        <pre id="execution-stderr" class="error-block"></pre>
        <img id="execution-image" style="max-width: 100%; display: none; margin-top: 20px;" />
      </section>
    </div>


  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/languages/python.min.js"></script>
  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
<div id="reasoning-loader" class="loader-message" style="display: none;">
  <i class="fas fa-spinner fa-spin"></i> Reasoning...
</div>
</body>
</html>
